# *RUNNING CC* 静电场可视化平台

## 项目概述

*RUNNING CC* 是一个基于Python开发的静电场可视化平台，采用现代化的Web界面和高性能计算引擎，支持多种电荷类型的电场计算与可视化。该平台旨在为物理教学和科研提供直观、高效的静电场分析工具。

### 核心特性

- **多电荷类型支持**：点电荷、无限长线电荷、圆环电荷
- **高性能计算**：基于NumPy的矢量化计算，支持大量电荷叠加
- **丰富的可视化**：2D/3D电场强度分布、电势分布、电场线轨迹
- **交互式界面**：基于Streamlit的Web应用，支持实时参数调整
- **动态主题**：根据时间自动切换主题风格
- **自适应电场线追踪**：智能调整步长的电场线生成算法

## 技术栈

- **核心计算**：Python 3.8+, NumPy, SciPy
- **可视化**：Matplotlib, Plotly
- **Web框架**：Streamlit

## 安装与运行

### 环境要求

- Python 3.8 或更高版本
- 支持的操作系统：Windows, macOS, Linux

### 快速启动（Windows）

1. 下载或克隆项目到本地
2. 双击运行 `run_app.bat` 脚本
3. 脚本将自动：
   - 检查Python环境
   - 创建并激活虚拟环境
   - 安装所有依赖
   - 启动Web应用
4. 浏览器将自动打开应用地址（默认：http://localhost:8506）

### 手动安装（所有平台）

1. 克隆或下载项目
2. 进入项目根目录
3. 创建虚拟环境：
   ```bash
   python -m venv venv
   ```
4. 激活虚拟环境：
   - Windows: `venv\Scripts\activate`
   - macOS/Linux: `source venv/bin/activate`
5. 安装依赖：
   ```bash
   pip install -r requirements.txt
   ```
6. 启动应用：
   ```bash
   python -m streamlit run ui/app.py
   ```

## 功能介绍

### 1. 电荷系统构建

平台支持三种基本电荷类型，可通过界面灵活配置：

- **点电荷**：可设置电荷量、位置、显示半径
- **无限长线电荷**：可设置线密度、位置
- **圆环电荷**：可设置电荷量、半径、位置

### 2. 电场计算

基于电场叠加原理，平台支持：

- 多电荷系统的总电场强度计算
- 电势分布计算
- 电场线轨迹追踪（自适应步长算法）

### 3. 可视化功能

- **2D电场强度分布**：热力图显示场强大小
- **3D电场矢量场**：箭头图显示场强方向和大小
- **电势等高线**：等值线图显示电势分布
- **电场线轨迹**：流线图显示电场线

### 4. 性能优化

- 矢量化计算：相比传统标量循环，性能提升显著
- 自适应算法：根据场强自动调整计算步长
- 内存优化：高效的数组操作，支持大规模计算

## 使用指南

### 基本操作流程

1. **启动应用**：运行 `run_app.bat` 或手动启动
2. **配置电荷**：在左侧面板添加和配置电荷
3. **选择计算类型**：电场强度、电势或电场线
4. **调整可视化参数**：分辨率、颜色映射、视图角度等
5. **查看结果**：在主面板查看可视化结果
6. **保存结果**：可下载图像或数据

### 高级功能

- **多视图切换**：2D/3D视图无缝切换
- **参数联动**：修改电荷参数后实时更新结果
- **性能监控**：查看计算时间和资源占用
- **主题切换**：自动或手动切换界面主题

## 核心算法说明

### 1. 电场叠加原理

```
E_total = Σ E_i
```

其中，`E_i` 是第i个电荷在空间某点产生的电场强度，遵循库仑定律：

```
E_i = k·q_i·r̂ / r²
```

- `k`：库仑常数（8.9875517923 × 10⁹ N·m²/C²）
- `q_i`：第i个电荷的电荷量
- `r`：电荷到计算点的距离
- `r̂`：从电荷指向计算点的单位矢量

### 2. 电势计算

电势遵循标量叠加原理：

```
V_total = Σ V_i
```

- 点电荷电势：`V = k·q / r`
- 线电荷电势：基于积分计算
- 圆环电荷电势：基于解析公式

### 3. 电场线追踪

采用自适应步长的欧拉积分算法：

1. 从起始点出发
2. 计算当前点的电场方向
3. 沿电场方向移动一小步（步长自适应调整）
4. 重复步骤2-3，直到达到终止条件

## 项目结构

```
├── core/                    # 核心计算模块
│   ├── field_calculator.py  # 电场强度计算器
│   ├── potential_calculator.py  # 电势计算器
│   └── field_line_tracer.py  # 电场线追踪器
├── physics/                 # 物理模型
│   ├── point.py             # 点电荷模型
│   ├── line.py              # 线电荷模型
│   └── ring.py              # 圆环电荷模型
├── ui/                      # 用户界面
│   └── app.py               # Streamlit应用主程序
├── utils/                   # 工具函数
│   ├── constants.py         # 物理常数
│   └── geometry.py          # 几何计算工具
├── requirements.txt         # 项目依赖
└── run_app.bat             # 启动脚本
```

## 代码示例

### 基本使用示例

```python
from core.field_calculator import FieldCalculator
from physics.point import PointCharge
import numpy as np

# 创建电荷系统
charges = [
    PointCharge(q=1e-6, position=[0, 0, 0]),  # 正电荷
    PointCharge(q=-1e-6, position=[1, 0, 0])   # 负电荷
]

# 初始化场计算器
calculator = FieldCalculator(charges)

# 计算电场强度
test_point = np.array([0.5, 0, 0])
E = calculator.electric_field(test_point)
print(f"电场强度: {E}")
print(f"场强大小: {np.linalg.norm(E):.6e} N/C")
```

### 性能对比

平台内置了性能对比测试，展示矢量化计算的优势：

```python
from core.field_calculator import performance_comparison

# 运行性能对比测试
performance_comparison()
```

## 扩展开发

### 添加新的电荷类型

1. 在 `physics/` 目录下创建新的电荷模型文件
2. 实现 `ChargeProtocol` 协议接口：
   ```python
   class NewChargeType:
       def electric_field(self, points: np.ndarray) -> np.ndarray:
           # 实现电场计算逻辑
           pass
       
       @property
       def q(self) -> float:
           # 返回电荷量
           pass
   ```
3. 在 `field_calculator.py` 中导入并使用新的电荷类型

### 扩展可视化功能

1. 在 `ui/app.py` 中添加新的可视化组件
2. 利用Matplotlib或Plotly的API实现新的可视化效果
3. 集成到Streamlit应用的界面中

## 技术亮点

1. **现代化Python开发**：
   - 使用Type Hints提高代码可读性和可维护性
   - 采用Protocol类实现面向接口编程
   - 利用NumPy的矢量化计算提升性能

2. **模块化设计**：
   - 清晰的分层架构
   - 低耦合的组件设计
   - 易于扩展和维护

3. **用户友好界面**：
   - 直观的Web界面
   - 实时交互反馈
   - 动态主题切换

4. **高性能计算**：
   - 矢量化计算避免Python循环开销
   - 自适应算法优化计算效率
   - 内存高效的数组操作

## 应用场景

- **物理教学**：直观展示电场分布和叠加原理
- **科研分析**：快速构建和分析复杂电荷系统
- **工程设计**：电场仿真和优化
- **学习研究**：理解静电场的基本概念和规律

## 联系方式

如有问题或建议，欢迎通过以下方式联系：
- 邮箱：[2409185982qq.com]

## 更新日志

### v1.0.0 (2025-12-6)

- 初始版本发布
- 支持点电荷、线电荷、圆环电荷
- 实现2D/3D可视化
- 自适应电场线追踪算法
- 基于Streamlit的Web界面

---

*RUNNING CC* - 让静电场可视化更简单、更高效！⚡

# 内置3D静电场可视化系统 - 基于球面三角形边界元法

## 项目简介

本项目是一个基于球面三角形边界元法（BEM）的3D静电场可视化系统，专门用于分析和可视化球形电极周围的静电场分布。系统采用精确的球面几何计算和自适应网格细分技术，结合宇宙风格的3D渲染效果，为用户提供直观、高效的静电场分析工具。

### 核心功能

- **精确的球面三角形网格生成**：基于正二十面体细分的球面网格，支持多级自适应细分
- **高效的边界元求解器**：实现球面三角形边界元法，支持高斯积分求解
- **多维度可视化**：
  - PyVista宇宙风格3D渲染，包含星空背景和电场线追踪
  - Plotly交互式2D/3D图表，支持多种数据可视化
- **分析与验证**：内置解析解验证功能，确保计算结果准确性
- **交互式探索**：支持实时调整参数和视角的交互式探索模式
- **性能基准测试**：提供系统性能评估工具

### 技术架构

| 模块 | 主要职责 | 文件 |
|------|----------|------|
| 主控制模块 | 工作流管理、参数配置 | main.py |
| 几何模型模块 | 球面三角形几何、网格生成 | Bemmodel.py |
| 边界元求解模块 | 系统矩阵组装、电场求解 | compute.py |
| 可视化模块 | 3D渲染、交互式图表 | visualization.py |

## 安装与环境配置

### 依赖项

- Python 3.7+
- PyVista (3D渲染)
- Plotly (交互式图表)
- NumPy (数值计算)
- SciPy (科学计算)
- Matplotlib (辅助绘图)

### 安装步骤

1. 克隆或下载项目文件到本地目录
2. 安装所需依赖：

```bash
pip install numpy scipy matplotlib pyvista plotly
```

## 使用说明

### 1. 参数配置

系统的主要参数集中在`main.py`文件中，用户可以根据需求修改以下关键参数：

| 参数 | 描述 | 默认值 |
|------|------|--------|
| `RADIUS` | 球面半径 | 1.0 |
| `CENTER` | 球心坐标 | (0, 0, 0) |
| `VOLTAGE` | 电极电压 | 1.0 |
| `SUBDIVISIONS` | 球面细分级别 | 3 |
| `STARFIELD_DENSITY` | 星空背景密度 | 100 |

### 2. 运行模拟

#### 基本模拟

在项目目录下执行以下命令启动模拟：

```bash
python main.py
```

系统将按照预设参数执行完整的模拟流程：

1. **生成球面三角形网格**：基于正二十面体细分生成球面网格
2. **边界元求解**：组装系统矩阵并求解电荷密度和电场分布
3. **生成可视化结果**：创建3D渲染和交互式图表
4. **输出结果**：保存图表和渲染文件到`output`目录

#### 交互式探索

系统支持交互式探索模式，允许用户实时调整参数并查看结果：

```python
# 在main.py中设置INTERACTIVE=True
INTERACTIVE = True
```

运行后，系统将启动交互式界面，用户可以：
- 调整球面细分级别
- 改变电压值
- 旋转和缩放3D视图
- 实时查看电场分布变化

#### 性能基准测试

系统内置性能基准测试功能，用于评估不同参数配置下的计算效率：

```python
# 在main.py中调用benchmark_performance()
benchmark_performance()
```

### 3. 输出结果

模拟完成后，系统将生成以下输出文件：

| 文件类型 | 描述 | 保存路径 |
|----------|------|----------|
| 3D渲染图像 | 宇宙风格的电场分布渲染 | output/3d_render.png |
| 电场线追踪 | 电场线3D可视化 | output/field_lines.png |
| 电荷密度分布 | 球面电荷密度2D热图 | output/charge_density.png |
| 电场强度分布 | 电场强度3D分布图 | output/electric_field.png |
| 性能报告 | 基准测试结果 | output/benchmark_report.txt |

### 4. 结果分析

#### 3D可视化结果

- **宇宙风格渲染**：展示电极表面电荷分布和周围电场线，背景为星空效果
- **电场线追踪**：从电极表面出发的电场线，颜色表示电场强度
- **等值面图**：不同电势值的等值面，直观展示电势分布

#### 数据分析图表

- **电荷密度分布**：电极表面电荷密度的2D热图和3D表面图
- **电场强度分布**：空间中电场强度的分布情况
- **解析解对比**：计算结果与解析解的对比，验证求解精度

## 核心算法说明

### 1. 球面三角形网格生成

系统采用基于正二十面体细分的方法生成球面三角形网格：

1. 生成初始正二十面体
2. 对每个三角形进行递归细分
3. 将顶点投影到球面上，保持精确的球面几何
4. 验证网格质量，确保三角形形状良好

### 2. 边界元求解

球面三角形边界元法的核心步骤：

1. **系统矩阵组装**：计算Green函数及其法向导数，生成G和H矩阵
2. **电荷密度求解**：解线性方程组得到表面电荷密度分布
3. **电场计算**：根据电荷密度计算空间任意点的电场强度
4. **解析解验证**：将计算结果与解析解对比，评估求解精度

### 3. 电场线追踪

采用龙格-库塔方法进行电场线追踪：

1. 从电极表面选取初始点
2. 沿电场方向积分，生成电场线
3. 自适应步长调整，确保追踪精度
4. 可视化电场线，颜色表示电场强度

## 扩展与定制

### 自定义电极形状

用户可以通过修改`Bemmodel.py`中的网格生成代码，创建自定义形状的电极：

```python
# 示例：生成椭球形电极网格
def generate_ellipsoid(a, b, c, subdivisions=3):
    # 实现椭球形网格生成逻辑
    pass
```

### 自定义可视化效果

系统支持自定义可视化效果，用户可以修改`visualization.py`中的渲染参数：

```python
# 示例：修改星空背景密度
viz = CosmicFieldVisualizer(solver, starfield_density=200)
```

### 增加求解算法

用户可以扩展`compute.py`中的求解器类，实现其他数值方法：

```python
# 示例：实现快速多极子方法加速
class FastMultipoleBEMSolver(SphericalBEMSolver):
    def assemble_system_matrices(self, gauss_order=4):
        # 实现快速多极子方法
        pass
```

## 性能优化建议

1. **调整细分级别**：根据计算资源和精度需求，合理设置`SUBDIVISIONS`参数
2. **优化高斯积分阶数**：在保证精度的前提下，降低`gauss_order`参数
3. **使用并行计算**：对于大规模问题，可以考虑在矩阵组装过程中使用并行计算
4. **内存管理**：对于极高细分级别，注意监控内存使用情况

## 典型应用场景

1. **球形电极电场分析**：研究高压球形电极周围的电场分布
2. **电容器设计**：分析球形电容器的电场特性
3. **电介质研究**：模拟不同介质环境下的电场分布
4. **教学演示**：直观展示静电场理论和边界元法原理
5. **科研分析**：为静电场相关研究提供数值模拟工具

## 总结

本项目实现了一个高效、精确的3D静电场可视化系统，基于球面三角形边界元法，结合宇宙风格的3D渲染效果，为用户提供了直观、强大的静电场分析工具。系统具有良好的扩展性和定制性，可用于多种静电场相关的研究和应用场景。

通过本系统，用户可以深入理解球形电极周围的静电场分布规律，验证解析解的正确性，以及探索不同参数对电场分布的影响。系统的交互式功能和美观的可视化效果，使其成为静电场教学和研究的有力工具。
